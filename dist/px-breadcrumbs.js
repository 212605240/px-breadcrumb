'use strict';(function(){Polymer({is:'px-breadcrumbs',properties:{breadcrumbData:{type:Array,value:function value(){return[]}},_mainPathItems:{type:Array,value:function value(){return[]}},_clickPathItem:{type:Object,value:function value(){return{}}},_clickedItemChildren:{type:Array,value:function value(){return[]}},_isDropdownHidden:{type:Boolean,value:true},_selectedItem:{type:Object,value:function value(){return{}}}},observers:['prepareData(_selectedItem)'],prepareData:function prepareData(){var _this=this;this._calculatePath().then(function(pathArray){return _this._breadcrumbsDisplayOptions(pathArray)}).then(function(pathArray){_this.set('_mainPathItems',pathArray)})},_calculateSizeOfBreadcrumbs:function _calculateSizeOfBreadcrumbs(strArray){if(strArray){var accumulativeSizeOfBreadcrumbs=0,ctx=this._createCanvas();for(var i=0;i<strArray.length;i++){accumulativeSizeOfBreadcrumbs+=parseInt(ctx.measureText(strArray[i].text).width,10);if(strArray[i].children){accumulativeSizeOfBreadcrumbs+=11}if(i!==strArray.length-1){accumulativeSizeOfBreadcrumbs+=15}}return accumulativeSizeOfBreadcrumbs}else{return 0}},_breadcrumbsDisplayOptions:function _breadcrumbsDisplayOptions(strArray){var _this2=this;return new Promise(function(accept,reject){var ctx=_this2._createCanvas(),accumulativeSizeOfAllBreadcrumbs=_this2._calculateSizeOfBreadcrumbs(strArray);Polymer.dom.flush();_this2.async(function(){var breadcrumbs=document.querySelector('px-breadcrumbs'),breadcrumbsContainer=Polymer.dom(breadcrumbs.root).querySelector('.container'),breadcrumbsUlContainer=Polymer.dom(breadcrumbsContainer).querySelector('ul'),bcUlContainerRect=breadcrumbsContainer.getBoundingClientRect(),ulWidth=bcUlContainerRect.width;if(ulWidth<accumulativeSizeOfAllBreadcrumbs){var allButTheLastItem=_this2._shortenLongAssetNames(strArray.slice(0,strArray.length-1)),sizeOfAllButLastItem=_this2._calculateSizeOfBreadcrumbs(allButTheLastItem),lastItem=_this2._calculateSizeOfBreadcrumbs(strArray.slice(-1));if(ulWidth<sizeOfAllButLastItem+lastItem){var shortenAllItems=_this2._shortenLongAssetNames(strArray),sizeOfAllShortenedItem=_this2._calculateSizeOfBreadcrumbs(shortenAllItems);if(ulWidth<sizeOfAllShortenedItem){var shortenAllItemsWithOverflow=99999,overflowArray=[],removedItem;while(ulWidth<shortenAllItemsWithOverflow){removedItem=strArray.shift();console.log(removedItem);overflowArray.push(removedItem);shortenAllItemsWithOverflow=_this2._calculateSizeOfBreadcrumbs(strArray)}var overflowObj={'text':'...','children':overflowArray};strArray.unshift(overflowObj);console.log('shorten everything, include overflow');return accept(strArray)}else{console.log('shorten everything fits');return accept(shortenAllItems)}}else{var lastItem=strArray.slice(strArray.length-1);if(allButTheLastItem){allButTheLastItem.push(lastItem[0])}console.log('shorten everything but the last one.');return accept(allButTheLastItem)}}else{console.log('everything fits off the bat');return accept(strArray)}},1500)})},_createCanvas:function _createCanvas(){var canvas=document.createElement('canvas');canvas.height=20;canvas.width=9999;this._measurementCanvas=canvas;var ctx=this._measurementCanvas.getContext('2d');ctx.font='15px GE Inspira Sans';return ctx},_isTextShorteningNecessery:function _isTextShorteningNecessery(pathArray){console.log('pathArray');console.log(pathArray)},_shortenLongAssetNames:function _shortenLongAssetNames(pathArray){for(var i=0,len=pathArray.length;i<len;i++){if(pathArray[i].text.length>16){this._returnShortenString(pathArray[i]).then(function(obj){var path=obj.path,shortenedString=obj.text;path.text=shortenedString})}else{if(pathArray[i].children){this._shortenLongAssetNames(pathArray[i].children)}debugger;return pathArray}}},_returnShortenString:function _returnShortenString(pathItem){return new Promise(function(accept,reject){var string=pathItem.text,beginning=string.substring(0,6),middle='...',end=string.substring(string.length-6);return accept({'text':beginning+middle+end,'path':pathItem})})},_normalizePathClickTarget:function _normalizePathClickTarget(evt){return evt.target._iconsetName==='fa'?evt.target.parentNode.parentNode:evt.target},_resetSelectedItem:function _resetSelectedItem(){this.set('_selectedItem',false)},_calculatePath:function _calculatePath(){var _this3=this;return new Promise(function(accept,reject){var pathArray=[],currentDataObj=_this3.breadcrumbData,self=_this3,foundSelectedItem=false;var recursiveLoopThroughObj=function recursiveLoopThroughObj(pathItem){for(var i=0,len=pathItem.length;i<len;i++){if(foundSelectedItem){break};if(pathItem[i].selectedItem){pathArray.push(pathItem[i]);self.set('_selectedItem',pathItem[i]);foundSelectedItem=true;break}if(pathItem[i].children){pathArray.push(pathItem[i]);recursiveLoopThroughObj(pathItem[i].children)}}};recursiveLoopThroughObj(currentDataObj);return accept(pathArray)})},_doesItemHaveChildren:function _doesItemHaveChildren(itemInPath){return itemInPath.hasChildren},_isNotLastItemInData:function _isNotLastItemInData(index){return this._mainPathItems.length-1!==index},_calculatePathclass:function _calculatePathclass(index){return!this._isNotLastItemInData(index)?' selected':''},_dropdownTap:function _dropdownTap(evt){this._resetSelectedItem();var newSelectItem=evt.model.item;this._setSelectedItem(newSelectItem);this.set('_isDropdownHidden',true);this.set('_clickPathItem',{})},_setSelectedItem:function _setSelectedItem(selectedItem){selectedItem.selectedItem=true;this.set('_selectedItem',selectedItem)},_onPathTap:function _onPathTap(evt){var dataItem=evt.model.item;if(evt.model.item.selectedItem){evt.stopPropagation();return}if(this._clickPathItem===dataItem){this.set('_isDropdownHidden',true);this.set('_clickPathItem',{})}else{this.set('_clickPathItem',dataItem);this.set('_isDropdownHidden',false);this._changeDropdownPosition(evt)}if(this._doesItemHaveChildren(dataItem)){this.set('_clickedItemChildren',dataItem.children)}},_changeDropdownPosition:function _changeDropdownPosition(evt){var normalizedTarget=this._normalizePathClickTarget(evt),targetRect=normalizedTarget.getBoundingClientRect(),targetLeft=targetRect.left,targetBottom=targetRect.bottom,targetHeight=targetRect.height,windowScrollX=window.scrollX,windowScrollY=window.scrollY,dropdown=Polymer.dom(this.root).querySelector('.breadCrumbdropdown');dropdown.style.top=targetBottom+windowScrollY+4+'px';dropdown.style.left=targetLeft+windowScrollX+'px'},_notifyClick:function _notifyClick(item){this.dispatchEvent(new CustomEvent('px-breadcrumbs-item-clicked',{item:item,composed:true}))}})})();
//# sourceMappingURL=px-breadcrumbs.js.map
