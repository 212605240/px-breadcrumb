'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}(function(){Polymer({is:'px-breadcrumbs',properties:{breadcrumbData:{type:Array,value:function value(){return[]}},_mainPathItems:{type:Array,value:function value(){return[]}},_clickPathItem:{type:Object,value:function value(){return{}}},_clickedItemChildren:{type:Array,value:function value(){return[]}},_isDropdownHidden:{type:Boolean,value:true},_selectedItem:{type:Object},ulWidth:{type:Number,value:0}},behaviors:[Polymer.IronResizableBehavior],listeners:{'iron-resize':'_getContainerSize','px-breadcrumbs-item-selected':'_foundSelectedItem'},observers:['prepareData(_selectedItem)'],prepareData:function prepareData(){var _this=this;this._calculatePath().then(function(pathArray){return _this._breadcrumbsDisplayOptions(pathArray)}).then(function(pathArray){_this.set('_mainPathItems',pathArray)})},_getContainerSize:function _getContainerSize(){var _this2=this;this.debounce('windowResize',function(){window.requestAnimationFrame(function(){var breadcrumbsContainer=Polymer.dom(_this2.root).querySelector('.container'),breadcrumbsUlContainer=Polymer.dom(breadcrumbsContainer).querySelector('ul'),bcUlContainerRect=breadcrumbsContainer.getBoundingClientRect();_this2.set('ulWidth',bcUlContainerRect.width+4)});Polymer.RenderStatus.afterNextRender(_this2,function(){_this2.prepareData()})},10)},_breadcrumbsDisplayOptions:function _breadcrumbsDisplayOptions(strArray){var _this3=this;return new Promise(function(accept,reject){var breadcrumbsObj=new Breadcrumbs(strArray),ulWidth=_this3.ulWidth;if(ulWidth>breadcrumbsObj.sizeOfFullBreadcrumbs){return accept(strArray)}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem+breadcrumbsObj.sizeOfFullLastItem){var strArrayShortenedWithFullLastItem=breadcrumbsObj.allShortenedItemsExcludingLast.concat(breadcrumbsObj.lastItemFull);return accept(strArrayShortenedWithFullLastItem)}if(ulWidth>breadcrumbsObj.sizeOfAllShortenedItems){var strArrayShortened=breadcrumbsObj.shortenedItems;return accept(strArrayShortened)}return accept(_this3._createArrayWithOverflow(strArray,ulWidth,breadcrumbsObj))})},_createArrayWithOverflow:function _createArrayWithOverflow(strArray,ulWidth,breadcrumbsObj){return new Promise(function(accept,reject){var pointer=0,currentAccumSize=breadcrumbsObj.sizeOfAllShortenedItemsExcludingLastItem,sizeOfFullLastItem=breadcrumbsObj.sizeOfFullLastItem,sizeOfEllipsis=breadcrumbsObj.sizeOfEllipsis,noRoomForFullLastItem=false,lastItem={},overflowObj={'text':'...','hasChildren':true},slicedStrArray=[];while(ulWidth<sizeOfEllipsis+currentAccumSize+sizeOfFullLastItem){if(pointer===strArray.length-1){noRoomForFullLastItem=true;break}var removedSize=breadcrumbsObj.sizeOfIndividualShortItem(strArray[pointer]);currentAccumSize-=removedSize;pointer++}overflowObj.children=breadcrumbsObj.shortenedItems.slice(0,pointer);lastItem=noRoomForFullLastItem?breadcrumbsObj.lastItemShort:breadcrumbsObj.lastItemFull;slicedStrArray=[overflowObj].concat(breadcrumbsObj.shortenedItems.slice(pointer,strArray.length-1)).concat(lastItem);return accept(slicedStrArray)})},_normalizePathClickTarget:function _normalizePathClickTarget(evt){return evt.target._iconsetName==='fa'?evt.target.parentNode.parentNode:evt.target},_resetSelectedItem:function _resetSelectedItem(){this.set('_selectedItem',false)},_calculatePath:function _calculatePath(){var _this4=this;return new Promise(function(accept,reject){var graph=_this4.graph||new Graph(_this4.breadcrumbData,_this4),pathArray=graph.selectedItemPath;_this4.set('graph',graph);return accept(pathArray)})},_addParentPropToItem:function _addParentPropToItem(parent){var i=0,children=parent.children,len=children.length,breadcrumbsObj=this.breadcrumbsObj;for(;i<len;i++){var newItem={};newItem.children=children[i].children;newItem.text=children[i].text;newItem.hasChildren=children[i].hasChildren;newItem.selectedItem=children[i].selectedItem;newItem.parent=parent;breadcrumbsObj._addToWeakMap=newItem}},_doesItemHaveSiblings:function _doesItemHaveSiblings(itemInPath){var graph=this.graph,hasSibling=graph.hasSiblings(itemInPath);return hasSibling},_doesItemHaveChildrenAndIsNotFirst:function _doesItemHaveChildrenAndIsNotFirst(itemInPath,index){return itemInPath&&itemInPath.hasChildren&&index!==0},_isLastItemInData:function _isLastItemInData(index){return this._mainPathItems.length-1===index},_dropdownTap:function _dropdownTap(evt){this._resetSelectedItem();var newSelectItem=evt.model.item;this._setSelectedItem(newSelectItem);this.set('_isDropdownHidden',true);this._changePathFromDropdownClick();this.set('_clickPathItem',{})},_changePathFromDropdownClick:function _changePathFromDropdownClick(){this.prepareData()},_foundSelectedItem:function _foundSelectedItem(evt){this._setSelectedItem(evt.detail.item)},_setSelectedItem:function _setSelectedItem(selectedItem){selectedItem.selectedItem=true;this.set('_selectedItem',selectedItem)},_onPathTap:function _onPathTap(evt){var dataItem=evt.model.item;if(evt.model.item.selectedItem){evt.stopPropagation();return}if(this._clickPathItem===dataItem){this.set('_isDropdownHidden',true);this.set('_clickPathItem',{})}else{this.set('_clickPathItem',dataItem);this.set('_isDropdownHidden',false);this._changeDropdownPosition(evt)}var sourceItem=dataItem.hasOwnProperty('source')?dataItem.source:dataItem;if(this._doesItemHaveSiblings(sourceItem)){var graph=this.graph,siblings=graph.getSiblings(sourceItem);this.set('_clickedItemChildren',siblings)}},_changeDropdownPosition:function _changeDropdownPosition(evt){var normalizedTarget=this._normalizePathClickTarget(evt),targetRect=normalizedTarget.getBoundingClientRect(),targetLeft=targetRect.left,targetBottom=targetRect.bottom,targetHeight=targetRect.height,windowScrollX=window.scrollX,windowScrollY=window.scrollY,dropdown=Polymer.dom(this.root).querySelector('.breadCrumbdropdown');dropdown.style.top=targetBottom+windowScrollY+4+'px';dropdown.style.left=targetLeft+windowScrollX+'px'},_notifyClick:function _notifyClick(item){this.fire('px-breadcrumbs-item-clicked',{item:item,composed:true})}});var Breadcrumbs=function(){function Breadcrumbs(){var breadcrumbs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];_classCallCheck(this,Breadcrumbs);this.breadcrumbs=breadcrumbs;this.map=new WeakMap;this.ctx=this._createCanvas();this._preShortenItems(this.breadcrumbs);return this}_createClass(Breadcrumbs,[{key:'_addItemToBreadcrumbsClassAndWeakMap',value:function _addItemToBreadcrumbsClassAndWeakMap(item){this.breadcrumbs.push(item);this._addToWeakMap(item)}},{key:'_addToWeakMap',value:function _addToWeakMap(item){var cachedItem=this.map.get(item)||null;if(!cachedItem){this.map.set(item,item)}}},{key:'_preShortenItems',value:function _preShortenItems(items){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=items[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var item=_step.value;this._getShortenedText(item)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:'_getShortenedText',value:function _getShortenedText(item){var cachedItem=this.map.get(item)||{};cachedItem.shortText=cachedItem.shortText||item.text.substr(0,6)+'...'+item.text.substr(item.text.length-6);this.map.set(item,cachedItem);return cachedItem.shortText}},{key:'_sizeOfIndividualFullItem',value:function _sizeOfIndividualFullItem(item){var cachedItem=this.map.get(item)||{};cachedItem.fullSize=cachedItem.fullSize||parseInt(this.ctx.measureText(item.text).width,10);this.map.set(item,cachedItem);return cachedItem.fullSize}},{key:'sizeOfIndividualShortItem',value:function sizeOfIndividualShortItem(item){var cachedItem=this.map.get(item)||{};cachedItem.shortSize=cachedItem.shortSize||parseInt(this.ctx.measureText(cachedItem.shortText).width,10);this.map.set(item,cachedItem);return cachedItem.shortSize}},{key:'_calculateSizeOfBreadcrumbs',value:function _calculateSizeOfBreadcrumbs(strArray){var useFullSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(strArray){var accum=0,i=0,len=strArray.length,sizeOfItem=void 0;for(i=0;i<len;i++,sizeOfItem=null){if(useFullSize){sizeOfItem=this._sizeOfIndividualFullItem(strArray[i])}else{sizeOfItem=this.sizeOfIndividualShortItem(strArray[i])}accum+=sizeOfItem+15;if(strArray[i].children){accum+=11}}return accum}}},{key:'_createCanvas',value:function _createCanvas(){var canvas=document.createElement('canvas');canvas.height=20;canvas.width=9999;var ctx=canvas.getContext('2d');ctx.font='15px GE Inspira Sans';return ctx}},{key:'sizeOfFullBreadcrumbs',get:function get(){this.__sizeOfFullBreadcrumbs=this.__sizeOfFullBreadcrumbs||this._calculateSizeOfBreadcrumbs(this.breadcrumbs);return this.__sizeOfFullBreadcrumbs}},{key:'sizeOfAllShortenedItemsExcludingLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(0,this.breadcrumbs.length-1),false)}},{key:'sizeOfFullLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1))}},{key:'sizeOfShortLastItem',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1),false)}},{key:'lastItemFull',get:function get(){return this.breadcrumbs.slice(-1)[0]}},{key:'lastItemShort',get:function get(){return this.shortenedItems.slice(-1)[0]}},{key:'shortenedItems',get:function get(){var _this5=this;this.__shortenedItems=this.__shortenedItems||this.breadcrumbs.map(function(item){var wrapper={};wrapper.source=item;wrapper.isTruncated=true;wrapper.text=_this5._getShortenedText(item);wrapper.children=item.children;wrapper.selectedItem=item.selectedItem;wrapper.hasChildren=item.hasChildren;return wrapper});return this.__shortenedItems}},{key:'sizeOfEllipsis',get:function get(){return parseInt(this.ctx.measureText('...').width,10)}},{key:'sizeOfAllShortenedItems',get:function get(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs,false)}},{key:'allShortenedItemsExcludingLast',get:function get(){return this.shortenedItems.slice(0,this.shortenedItems.length-1)}}]);return Breadcrumbs}();;var Graph=function(){function Graph(nodes,pxBreacdcrumbs){_classCallCheck(this,Graph);this.map=new WeakMap;this._selectedItem=null;this.graph=this._crawlGraph(nodes,pxBreacdcrumbs);this.nodes=nodes;return this}_createClass(Graph,[{key:'_crawlGraph',value:function _crawlGraph(nodes,pxBreacdcrumbs){var recursiveLoopThroughObj=function(nodes,parent){var path=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var metaData={};for(var i=0,len=nodes.length;i<len;i++){if(parent){metaData.parent=parent}if(nodes[i].children){metaData.children=nodes[i].children;path=path.concat(parent?[parent]:[]);recursiveLoopThroughObj.call(this,nodes[i].children,nodes[i],path)}metaData.path=path.concat(parent?[parent]:[]);if(nodes[i].selectedItem){this._selectedItem=nodes[i];metaData.path=path.concat(parent,nodes[i]);pxBreacdcrumbs.fire('px-breadcrumbs-item-selected',{item:nodes[i]})}this.map.set(nodes[i],metaData)}}.bind(this);recursiveLoopThroughObj(nodes)}},{key:'hasSiblings',value:function hasSiblings(item){debugger;var parent=this.map.get(item).parent;return parent.children?true:false}},{key:'getSiblings',value:function getSiblings(item){var parent=this.map.get(item).parent;return parent.children.filter(function(sibling){return sibling!==item})}},{key:'selectedItem',get:function get(){return this._selectedItem},set:function set(item){debugger;if(item){this._selectedItem.selectedItem=false;item.selectedItem=true;this._selectedItem=item}}},{key:'selectedItemPath',get:function get(){var metaData=this.map.get(this._selectedItem);return metaData?metaData.path:undefined}}]);return Graph}()})();
//# sourceMappingURL=px-breadcrumbs.js.map
