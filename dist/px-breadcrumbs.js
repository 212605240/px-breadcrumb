'use strict';(function(){Polymer({is:'px-breadcrumbs',properties:{breadcrumbData:{type:Array,value:function value(){return[]}},_mainPathItems:{type:Array,value:function value(){return[]}},_clickPathItem:{type:Object,value:function value(){return{}}},_clickedItemChildren:{type:Array,value:function value(){return[]}},_isDropdownHidden:{type:Boolean,value:true},_selectedItem:{type:Object,value:function value(){return{}}}},created:function created(){var _this=this;this.async(function(){_this._createCanvas()})},observers:['prepareData(_selectedItem)'],prepareData:function prepareData(){var _this2=this;this._calculatePath().then(function(pathArray){return _this2._breadcrumbsDisplayOptions(pathArray)}).then(function(pathArray){_this2.set('_mainPathItems',pathArray)})},_calculateSizeOfBreadcrumbs:function _calculateSizeOfBreadcrumbs(strArray,map){var useFullSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(strArray){var ctx=this.ctx;for(var i=0;i<strArray.length;i++){var item=map.get(strArray[i])||{};var thingToMeasure=useFullSize?strArray[i].text:item.truncatedText;var sizeOfItem=parseInt(ctx.measureText(thingToMeasure).width,10);if(strArray[i].children){sizeOfItem+=11}item[useFullSize?'fullSize':'truncatedSize']=sizeOfItem;map.set(strArray[i],item)}}return map},_calculateAcummSize:function _calculateAcummSize(items,map,requiredParam){return items.reduce(function(accum,item,index){if(index!==items.length-1){accum+=15}return accum+map.get(item)[requiredParam]},0)},_breadcrumbsDisplayOptions:function _breadcrumbsDisplayOptions(strArray){var _this3=this;return new Promise(function(accept,reject){var ctx=_this3.ctx,map=new WeakMap,accumulativeSizeOfAllBreadcrumbs;map=_this3._calculateSizeOfBreadcrumbs(strArray,map,true);accumulativeSizeOfAllBreadcrumbs=_this3._calculateAcummSize(strArray,map,'fullSize');_this3.async(function(){var breadcrumbs=document.querySelector('px-breadcrumbs'),breadcrumbsContainer=Polymer.dom(breadcrumbs.root).querySelector('.container'),breadcrumbsUlContainer=Polymer.dom(breadcrumbsContainer).querySelector('ul'),bcUlContainerRect=breadcrumbsContainer.getBoundingClientRect(),ulWidth=bcUlContainerRect.width+4;if(ulWidth<accumulativeSizeOfAllBreadcrumbs){map=_this3._shortenLongAssetNames(strArray,map);sizeOfAllButLastItem=_this3._calculateAcummSize(strArray.slice(0,strArray.length-1),map,false);var beginningItems=strArray.slice(0,strArray.length-1);var lastItem=strArray.slice(-1);var preparePromise=function preparePromise(){var shortenedAllButTheLastItems,sizeOfAllButLastItem,sizeOfLastItem;_this3._shortenLongAssetNames(allButTheLastItem).then(function(result){shortenedAllButTheLastItems=result;return _this3._calculateSizeOfBreadcrumbs(shortenedAllButTheLastItems)}).then(function(size){sizeOfAllButLastItem=size;return _this3._calculateSizeOfBreadcrumbs(lastItem)}).then(function(size){sizeOfLastItem=size;return Promise.resolve({sizeOfLastItem:sizeOfLastItem,sizeOfAllButLastItem:sizeOfAllButLastItem,shortenedAllButTheLastItems:shortenedAllButTheLastItems})})};preparePromise.then(function(_ref){var sizeOfLastItem=_ref.sizeOfLastItem,sizeOfAllButLastItem=_ref.sizeOfAllButLastItem,shortenedAllButTheLastItems=_ref.shortenedAllButTheLastItems;if(ulWidth<sizeOfAllButLastItem+sizeOfLastItem+26){var shortenAllItems=_this3._shortenLongAssetNames(strArray),sizeOfAllShortenedItem=_this3._calculateSizeOfBreadcrumbs(shortenAllItems);if(ulWidth<sizeOfAllShortenedItem){var shortenAllItemsWithOverflow=99999,overflowArray=[],removedItem;while(ulWidth<shortenAllItemsWithOverflow+lastItem+26){removedItem=allButTheLastItem.shift();overflowArray.push(removedItem);console.log(overflowArray);shortenAllItemsWithOverflow=_this3._calculateSizeOfBreadcrumbs(allButTheLastItem)}var overflowObj={'text':'...','children':overflowArray};allButTheLastItem.unshift(overflowObj);allButTheLastItem.push(strArray.slice(-1)[0]);console.log('shorten everything, include overflow');return accept(allButTheLastItem)}else{console.log('shorten everything fits');return accept(shortenAllItems)}}else{var lastItem=strArray.slice(strArray.length-1);if(allButTheLastItem){allButTheLastItem.push(lastItem[0])}console.log('shorten everything but the last one.');return accept(allButTheLastItem)}})}else{console.log('everything fits off the bat');return accept(strArray)}},1500)})},_createCanvas:function _createCanvas(){var canvas=document.createElement('canvas');canvas.height=20;canvas.width=9999;this._measurementCanvas=canvas;var ctx=this._measurementCanvas.getContext('2d');ctx.font='15px GE Inspira Sans';this.set('ctx',ctx)},_shortenLongAssetNames:function _shortenLongAssetNames(pathArray,map){for(var i=0,len=pathArray.length;i<len;i++){var item=map.get(pathArray[i])||{};item.truncatedText=pathArray[i].text.length>16?this._returnShortenString(pathArray[i].text):pathArray[i].text;map.set(pathArray[i],item);if(pathArray[i].children){this._shortenLongAssetNames(pathArray[i].children,map)}}return map},_returnShortenString:function _returnShortenString(itemText){var beginning=itemText.subitemText(0,6),middle='...',end=itemText.subitemText(itemText.length-6);return beginning+middle+end},_normalizePathClickTarget:function _normalizePathClickTarget(evt){return evt.target._iconsetName==='fa'?evt.target.parentNode.parentNode:evt.target},_resetSelectedItem:function _resetSelectedItem(){this.set('_selectedItem',false)},_calculatePath:function _calculatePath(){var _this4=this;return new Promise(function(accept,reject){var pathArray=[],currentDataObj=_this4.breadcrumbData,self=_this4,foundSelectedItem=false;var recursiveLoopThroughObj=function recursiveLoopThroughObj(pathItem){for(var i=0,len=pathItem.length;i<len;i++){if(foundSelectedItem){break};if(pathItem[i].selectedItem){pathArray.push(pathItem[i]);foundSelectedItem=true;break}if(pathItem[i].children){pathArray.push(pathItem[i]);recursiveLoopThroughObj(pathItem[i].children)}}};recursiveLoopThroughObj(currentDataObj);return accept(pathArray)})},_doesItemHaveChildren:function _doesItemHaveChildren(itemInPath){return itemInPath&&itemInPath.hasChildren},_isLastItemInData:function _isLastItemInData(index){return this._mainPathItems[this._mainPathItems.length-1]===this._mainPathItems[index]},_calculatePathclass:function _calculatePathclass(index){return this._isLastItemInData(index)?' selected':''},_dropdownTap:function _dropdownTap(evt){this._resetSelectedItem();var newSelectItem=evt.model.item;this._setSelectedItem(newSelectItem);this.set('_isDropdownHidden',true);this._changePathFromDropdownClick();this.set('_clickPathItem',{})},_changePathFromDropdownClick:function _changePathFromDropdownClick(){this.prepareData()},_setSelectedItem:function _setSelectedItem(selectedItem){selectedItem.selectedItem=true;this.set('_selectedItem',selectedItem)},_onPathTap:function _onPathTap(evt){var dataItem=evt.model.item;if(evt.model.item.selectedItem){evt.stopPropagation();return}if(this._clickPathItem===dataItem){this.set('_isDropdownHidden',true);this.set('_clickPathItem',{})}else{this.set('_clickPathItem',dataItem);this.set('_isDropdownHidden',false);this._changeDropdownPosition(evt)}if(this._doesItemHaveChildren(dataItem)){this.set('_clickedItemChildren',dataItem.children)}},_changeDropdownPosition:function _changeDropdownPosition(evt){var normalizedTarget=this._normalizePathClickTarget(evt),targetRect=normalizedTarget.getBoundingClientRect(),targetLeft=targetRect.left,targetBottom=targetRect.bottom,targetHeight=targetRect.height,windowScrollX=window.scrollX,windowScrollY=window.scrollY,dropdown=Polymer.dom(this.root).querySelector('.breadCrumbdropdown');dropdown.style.top=targetBottom+windowScrollY+4+'px';dropdown.style.left=targetLeft+windowScrollX+'px'},_notifyClick:function _notifyClick(item){this.dispatchEvent(new CustomEvent('px-breadcrumbs-item-clicked',{item:item,composed:true}))}})})();
//# sourceMappingURL=px-breadcrumbs.js.map
